/*!
 * indexer.js
 *
 * Copyright (c) "kento" Karim Rahimpur www.itthinx.com
 *
 * This code is provided subject to the license granted.
 * Unauthorized use and distribution is prohibited.
 * See COPYRIGHT.txt and LICENSE.txt
 *
 * This code is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 *
 * This header and all notices must be kept intact.
 *
 * @author itthinx
 * @package woocommerce-product-search
 * @since 2.0.0
 */
;var wpsIndexer={},wpsIndexerStatus={running:true,polling:false};wpsIndexer.start=function(b,e){var c=jQuery("#wps-index-status"),a=jQuery("#wps-index-update"),d=jQuery("#wps-index-blinker");d.addClass("blinker");c.html(this.msg_starting);jQuery(".wps-index-start-button").prop("disabled",true);jQuery("#wps_index_rebuild").prop("disabled",true);jQuery.ajax({type:"POST",url:b,data:{},complete:function(){wpsIndexer.started=true;d.removeClass("blinker")},success:function(f){jQuery("#wps_index_stop").prop("disabled",false);jQuery("#wps_index_rebuild").prop("disabled",false);if(typeof f.time!=="undefined"){a.html(wpsIndexer.msg_started);if(typeof f.errors!=="undefined"&&Array.isArray(f.errors)){a.append('<p style="color:#f00">'+f.errors.join("<br/>")+"</p>")}if(typeof f.notices!=="undefined"&&Array.isArray(f.notices)){a.append('<p style="color:#060">'+f.notices.join("<br/>")+"</p>")}}},dataType:"json"})};wpsIndexer.stop=function(b,e){var c=jQuery("#wps-index-status"),a=jQuery("#wps-index-update"),d=jQuery("#wps-index-blinker");d.addClass("blinker");c.html(this.msg_stopping);jQuery(".wps-index-stop-button").prop("disabled",true);jQuery("#wps_index_rebuild").prop("disabled",true);jQuery.ajax({type:"POST",url:b,data:{},complete:function(){wpsIndexer.started=false;d.removeClass("blinker")},success:function(f){jQuery("#wps_index_start").prop("disabled",false);jQuery("#wps_index_rebuild").prop("disabled",false);if(typeof f.time!=="undefined"){a.html(wpsIndexer.msg_stopped);if(typeof f.errors!=="undefined"&&Array.isArray(f.errors)){a.append('<p style="color:#f00">'+f.errors.join("<br/>")+"</p>")}if(typeof f.notices!=="undefined"&&Array.isArray(f.notices)){a.append('<p style="color:#060">'+f.notices.join("<br/>")+"</p>")}}},dataType:"json"})};wpsIndexer.rebuild=function(b,e){var c=jQuery("#wps-index-status"),a=jQuery("#wps-index-update"),d=jQuery("#wps-index-blinker");d.addClass("blinker");c.html(this.msg_rebuilding);jQuery(".wps-index-rebuild-button").prop("disabled",true);jQuery(".wps-index-start-button").prop("disabled",true);jQuery(".wps-index-stop-button").prop("disabled",true);jQuery("#wps-index-status-display").html("&mdash;");jQuery("#wps-index-status-total").html("&mdash;");jQuery("#wps-index-status-processable").html("&mdash;");jQuery("#wps-index-status-next-scheduled").html("&mdash;");jQuery.ajax({type:"POST",url:b,data:{},complete:function(){wpsIndexer.started=true;d.removeClass("blinker")},success:function(f){jQuery(".wps-index-rebuild-button").prop("disabled",false);jQuery(".wps-index-stop-button").prop("disabled",false);if(typeof f.time!=="undefined"){a.html(wpsIndexer.msg_rebuilt);if(typeof f.errors!=="undefined"&&Array.isArray(f.errors)){a.append('<p style="color:#f00">'+f.errors.join("<br/>")+"</p>")}if(typeof f.notices!=="undefined"&&Array.isArray(f.notices)){a.append('<p style="color:#060">'+f.notices.join("<br/>")+"</p>")}}},dataType:"json"})};wpsIndexer.run_once=function(b,e){var c=jQuery("#wps-index-status"),a=jQuery("#wps-index-update"),d=jQuery("#wps-index-blinker");d.addClass("blinker");c.html(this.msg_run);jQuery(".wps-index-run-button").prop("disabled",true);jQuery.ajax({type:"POST",url:b,data:{},complete:function(){wpsIndexer.started=true;d.removeClass("blinker")},success:function(f){jQuery("#wps_index_run").prop("disabled",false);if(typeof f.time!=="undefined"){a.html(wpsIndexer.msg_ran);if(typeof f.errors!=="undefined"&&Array.isArray(f.errors)){a.append('<p style="color:#f00">'+f.errors.join("<br/>")+"</p>")}if(typeof f.notices!=="undefined"&&Array.isArray(f.notices)){a.append('<p style="color:#060">'+f.notices.join("<br/>")+"</p>")}}},dataType:"json"})};wpsIndexerStatus.exec=function(){wpsIndexerStatus.timeout=setTimeout(function(){if(wpsIndexerStatus.running){if(!wpsIndexerStatus.polling){wpsIndexerStatus.poll()}wpsIndexerStatus.exec()}},10000)};wpsIndexerStatus.poll=function(){var a=null,c=jQuery("#wps-index-status-display"),e=jQuery("#wps-index-status-processable"),b=jQuery("#wps-index-status-total"),d=jQuery("#wps-index-status-next-scheduled");if(typeof wpsIndexerStatus.url!=="undefined"){a=wpsIndexerStatus.url}else{return}c.addClass("blinker");wpsIndexerStatus.polling=true;jQuery.ajax({type:"POST",url:a,data:{},complete:function(){wpsIndexerStatus.polling=false;c.removeClass("blinker")},success:function(f){if(typeof f.pct!=="undefined"){c.html(""+Number.parseFloat(f.pct).toFixed(2))}if(typeof f.processable!=="undefined"){e.html(" "+f.processable)}if(typeof f.total!=="undefined"){b.html(" "+f.total)}if(typeof f.next_scheduled_datetime!=="undefined"){d.html(" "+f.next_scheduled_datetime)}else{d.html("&mdash;")}if(typeof f.status!=="undefined"){if(f.status){jQuery("#wps_index_start").prop("disabled",true);jQuery("#wps_index_stop").prop("disabled",false)}else{jQuery("#wps_index_start").prop("disabled",false);jQuery("#wps_index_stop").prop("disabled",true)}}},dataType:"json"});if(typeof wpsIndexerStatus.cron!=="undefined"){jQuery.ajax({url:wpsIndexerStatus.cron})}};jQuery(document).ready(function(){wpsIndexerStatus.exec()});