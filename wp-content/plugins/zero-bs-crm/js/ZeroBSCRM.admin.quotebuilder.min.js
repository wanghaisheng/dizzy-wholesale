var quoteTemplateBlocker=!1;function zbscrm_appendTextToEditor(e){"function"==typeof window.parent.send_to_editor&&window.parent.send_to_editor(e)}function zbscrm_getTemplatedQuote(t,o){if(!window.quoteTemplateBlocker){var e="";0<jQuery("#zbscq_customer").length&&(e=jQuery("#zbscq_customer").val());var a=0;0<jQuery("#zbs_quote_template_id").length&&(a=parseInt(jQuery("#zbs_quote_template_id").val()));var i="";0<jQuery("#name").length&&(i=jQuery("#name").val());var l="";0<jQuery("#val").length&&(l=jQuery("#val").val());var r="";0<jQuery("#date").length&&(r=jQuery("#date").val());var u={};if(2<zbscrm_JS_DAL()&&jQuery.map(jQuery("#zbs-edit-form").serializeArray(),function(e,t){u[e.name]=e.value}),empty(e))return empty(e)&&swal({title:"Error!",text:"Please Choose a Customer",type:"error",confirmButtonText:"OK"}),empty(a)&&swal({title:"Error!",text:"Please Choose a Template",type:"error",confirmButtonText:"OK"}),window.quoteTemplateBlocker=!1;empty(a)?(window.quoteTemplateBlocker=!1,"function"==typeof t&&t()):(quoteTemplateAJAX=jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"zbs_get_quote_template",quote_fields:u,cust_id:e,quote_type:a,quote_title:i,quote_val:l,quote_dt:r,security:jQuery("#quo-ajax-nonce").val()},dataType:"json"}),quoteTemplateAJAX.done(function(e){swal({title:"Success!",text:"Quote Template Populated",type:"success",confirmButtonText:"OK"}),setTimeout(function(){zbscrm_appendTextToEditor(e.html)},500),window.quoteTemplateBlocker=!1,"function"==typeof t&&t()}),quoteTemplateAJAX.fail(function(e){swal({title:"Error!",text:"Failed retrieving template! If this error persists please contact Jetpack CRM support.",type:"error",confirmButtonText:"OK"}),window.quoteTemplateBlocker=!1,"function"==typeof o&&o()}))}}function jpcrm_quotes_send_email_modal(){var e,t,o=jQuery("#zbsQuoteBuilderEmailTo").val();void 0!==o&&""!=o&&zbscrm_JS_validateEmail(o)?(e='<div id="jpcrm_quote_email_modal_opts">',e+='<div class="jpcrm-send-email-modal-field">',e+='<label for="jpcrm_quote_email_modal_toemail">'+jpcrm_quotes_lang("toemail")+"</label>",e+='<input type="email" id="jpcrm_quote_email_modal_toemail" value="'+o+'" placeholder="'+jpcrm_quotes_lang("toemailplaceholder")+'" />',e+="</div>",0<jQuery(".zbsFileLine").length&&(e+='<div class="jpcrm-send-email-modal-field">',t="",jQuery("#zbsc_sendattachments").is(":checked")&&(t='checked="checked" '),e+='<input type="checkbox" id="jpcrm_quote_email_modal_attachassoc" value="1" '+t+"/>",e+='<label for="jpcrm_quote_email_modal_attachassoc">'+jpcrm_quotes_lang("attachassoc")+"</label>",e+="</div>"),e+='<div class="jpcrm-send-email-modal-field">',e+='<input type="checkbox" id="jpcrm_quote_email_modal_attachaspdf" value="1" '+(t='checked="checked" ')+"/>",e+='<label for="jpcrm_quote_email_modal_attachaspdf">'+jpcrm_quotes_lang("attachpdf")+"</label>",e+="</div>",e+="</div>",swal({title:jpcrm_quotes_lang("send_email"),html:'<div class="ui segment">'+jpcrm_quotes_lang("sendthisemail")+e+"</div>",type:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:jpcrm_quotes_lang("sendthemail")}).then(function(e){var t,o,a;e.value&&(t=jQuery("#jpcrm_quote_email_modal_toemail").val(),o=parseInt(jQuery("#zbsQuoteBuilderEmailTo").attr("data-quoteid")),void 0!==t&&""!=t&&zbscrm_JS_validateEmail(t)&&0<o?(a=-1,0<jQuery("#jpcrm_quote_email_modal_attachassoc").length&&jQuery("#jpcrm_quote_email_modal_attachassoc").is(":checked")&&(a=1),e=-1,0<jQuery("#jpcrm_quote_email_modal_attachaspdf").length&&jQuery("#jpcrm_quote_email_modal_attachaspdf").is(":checked")&&(e=1),e={id:o,cid:jQuery("#zbscq_customer").val(),email:t,attachassoc:a,attachpdf:e},swal.fire({title:jpcrm_quotes_lang("sendingemail"),html:'<div style="clear:both">&nbsp;</div><div class="ui active loader" style="margin-top:2em;padding-bottom:2em"></div><div style="clear:both">&nbsp;</div>',showConfirmButton:!1,showCancelButton:!1,allowOutsideClick:!1}),jpcrm_quotes_send_email(e)):swal.fire(jpcrm_quotes_lang("sendneedsassignment")))})):swal.fire(jpcrm_quotes_lang("sendneedsassignment"))}function jpcrm_quotes_send_email(e){window.jpcrmQuoteBlocker||(window.jpcrmQuoteBlocker=!0,void 0!==e.id&&0<e.id&&void 0!==e.email&&zbscrm_JS_validateEmail(e.email)&&(e={action:"jpcrm_quotes_send_quote",sec:window.zbsEditSettings.nonce,em:e.email,qid:e.id,cid:e.cid,attachassoc:e.attachassoc,attachpdf:e.attachpdf},jQuery.ajax({url:ajaxurl,type:"POST",data:e,dataType:"json",success:function(e){swal(jpcrm_quotes_lang("senttitle"),jpcrm_quotes_lang("sent"),"info"),window.jpcrmQuoteBlocker=!1},error:function(e){swal(jpcrm_quotes_lang("senderrortitle")+" #19v3",jpcrm_quotes_lang("senderror"),"error"),window.jpcrmQuoteBlocker=!1}})))}function jpcrm_quotes_lang(e,t,o){if(void 0===t&&(t=""),void 0!==window.zbsEditViewLangLabels[e]){if(void 0===o)return window.zbsEditViewLangLabels[e];if(void 0!==window.zbsEditViewLangLabels[e][o])return window.zbsEditViewLangLabels[e][o]}return t}jQuery(document).ready(function(){jQuery("#zbsQuoteBuilderStep2").click(function(){zbscrm_getTemplatedQuote(function(){jQuery("#wpzbscsub_quotecontent").show(),jQuery("#zerobs-quote-content-edit").show(),jQuery("#wpzbscsub_quoteactions").show(),jQuery("#zerobs-quote-nextstep").show(),jQuery("#zbs-quote-builder-step-1").slideUp(),setTimeout(function(){jQuery("#zbs_quote_content_ifr").css("height","580px"),0<jQuery("#wpzbscsub_quotecontent").length&&jQuery("html, body").animate({scrollTop:jQuery("#wpzbscsub_quotecontent").offset().top},2e3),0<jQuery("#zerobs-quote-content-edit").length&&jQuery("html, body").animate({scrollTop:jQuery("#zerobs-quote-content-edit").offset().top},2e3)},0)})}),jQuery("#zbsQuoteBuilderStep3").click(function(){jQuery("#publish").click()}),jQuery("#zbsQuoteBuilderEmailTo").keyup(function(){var e=jQuery("#zbsQuoteBuilderEmailTo").val();void 0!==e&&""!=e&&zbscrm_JS_validateEmail(e)?(jQuery("#zbsQuoteBuilderEmailTo").css("border","1px solid #ddd"),jQuery("#zbsQuoteBuilderEmailToErr").hide()):(jQuery("#zbsQuoteBuilderEmailTo").css("border","2px solid orange"),jQuery("#zbsQuoteBuilderEmailToErr").show())}),jQuery("#zbsQuoteBuilderSendNotification").off("click").click(function(e,t){jpcrm_quotes_send_email_modal()}),void 0!==window.zbscrm_templated&&(jQuery("#zbs-quote-builder-step-1").hide(),jQuery("#wpzbscsub_quotecontent").show(),jQuery("#zerobs-quote-content-edit").show(),jQuery("#wpzbscsub_quoteactions").show(),jQuery("#zerobs-quote-nextstep").show()),jQuery("#zbsQuoteBuilderURL").length&&(document.getElementById("zbsQuoteBuilderURL").onclick=function(){this.select(),document.execCommand("copy")})});